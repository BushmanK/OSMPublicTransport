<?php
//----------------------
//Copyright Dmitry Serov
//----------------------
include '../db_connect.php';
 
$start = microtime(true);

//Работаем с БД
$dbconn = pg_connect("host=".HOST." dbname=".NAME_BD." user=".USER." password=".'PASSWORD') or die(pg_last_error());

$sql = "SELECT id, tags->'name' as name, tags->'operator' as operator, tags->'shelter' as shelter, tags->'bench' as bench, tags->'bin' as bin FROM nodes WHERE tags->'highway'='bus_stop' or tags->'public_transport'='platform' ORDER BY name";
$result = pg_query($sql) or die(pg_last_error());

echo "<table border width='100%'>";
echo "<tr>
<td>id</td>
<td>Название</td>
<td>Оператор</td>
<td>Навес</td>
<td>Скамейка</td>
<td>Мусорка</td>
</tr>";
    
while ($row = pg_fetch_assoc($result)){
	
	echo "<tr>
			<td><a href=http://www.openstreetmap.org/relation/".$row['id'].">" . $row['id'] . "</a></td>
			<td>" . $row['name'] . "</td>
			<td>" . $row['operator'] . "</td>
			<td>" . $row['shelter'] . "</td>
			<td>" . $row['bench'] . "</td>
			<td>" . $row['bin'] . "</td>
		  </tr>";
		
  $pt_count++;
}

echo "</table>";

// Очистка результата
pg_free_result($result);

// Закрытие соединения
pg_close($dbconn);

echo "Всего остановок: " . $pt_count . "<br>";

$time = microtime(true) - $start;
printf('Время выполнения: %.4F сек.', $time);
 
?>
