<?php
//----------------------
//Copyright Dmitry Serov
//----------------------
include '../db_connect.php';
 
$start = microtime(true);

//Работаем с БД
$dbconn = pg_connect("host=".HOST." dbname=".NAME_BD." user=".USER." password=".'PASSWORD') or die(pg_last_error());

$sql = "SELECT id, tags->'name' as name, tags->'bus' as bus, tags->'trolleybus' as trolleybus, tags->'tram' as tram FROM nodes WHERE tags->'public_transport'='stop_position' ORDER BY name";
$result = pg_query($sql) or die(pg_last_error());

echo "<table border width='100%'>";
echo "<tr>
<td>id</td>
<td>Название</td>
<td>Автобус</td>
<td>Троллейбус</td>
<td>Трамвай</td>
</tr>";
    
while ($row = pg_fetch_assoc($result)){
	
	echo "<tr>
			<td>" . $row['id'] . "</td>
			<td>" . $row['name'] . "</td>
			<td>" . $row['bus'] . "</td>
			<td>" . $row['trolleybus'] . "</td>
			<td>" . $row['tram'] . "</td>
		  </tr>";
		
  $pt_count++;
}

echo "</table>";

// Очистка результата
pg_free_result($result);

// Закрытие соединения
pg_close($dbconn);

echo "Всего мест остановки: " . $pt_count . "<br>";

$time = microtime(true) - $start;
printf('Время выполнения: %.4F сек.', $time);
 
?>
