INSERT INTO routes_location (place_id, route_id)
SELECT
	places.id as place_id,
	routes.id as route_id
FROM places,
(SELECT 
	relations.id,
	ST_Union(nodes.geom) as geom
FROM relations, relation_members, ways, nodes, unnest(ways.nodes) WITH ORDINALITY AS t_nodes(node_id,node_pos)
WHERE
	relations.tags->'type'='route' and
	relations.tags->'route' in ('bus','trolleybus','tram')and
	relations.id=relation_members.relation_id and
	--relations.id='2297586' and
	relation_members.member_role='' and
	relation_members.member_id=ways.id and
	nodes.id = t_nodes.node_id
GROUP BY relations.id) as routes
WHERE
	ST_Contains(places.geom,routes.geom) or
	ST_Crosses(places.geom,routes.geom);
